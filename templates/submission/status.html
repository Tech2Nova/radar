{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="loader" style="color: white;">
    <div class="bean"></div>
    <div class="text" style="color: white!important;">正在分析...</div>
    <p>任务 ID: {{ task_id }}</p>
    <p>当前状态: <span id="status">{{ status }}</span></p>
</div>

<script>
    function checkStatus(taskId) {
        fetch(`/status/${taskId}/`, {
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else if (data.status === 'reported') {
                window.location.href = data.redirect;
            } else {
                document.getElementById('status').innerText = data.status;
                setTimeout(() => checkStatus(taskId), 2000);
            }
        })
        .catch(error => {
            console.error('Status check failed:', error);
            setTimeout(() => checkStatus(taskId), 2000);
        });
    }

    window.onload = () => checkStatus('{{ task_id }}');
</script>
{% endblock %}