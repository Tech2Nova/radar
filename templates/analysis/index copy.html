{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container-fluid mt-5">
    <div class="row">
        <!-- 文件/URL 概览区域 -->

        <div class="col-md-5">
                <div class="card" style="background-color: #171625">
                    <div class="card-header">
                        <h4  style="color: white!important; padding-left: 10px"> 文件概览</h4>
                    </div>
                    <div class="card-body">
                        <div class="file-info">
                            <ul>
                                <li ><strong>文件名:</strong> sample.exe</li>
                                <li ><strong>MD5:</strong> 6b86b273ff34fce19d6b804eff5a3f57</li>
                                <li ><strong>文件类型:</strong> 可执行文件 (PE)</li>
                                <li ><strong>文件大小:</strong> 245.7 KB</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        <!-- 分数区域 -->
        <div class="col-md-4">
            {% if analysis.info.score < 1 %}
                <div class="card">
                    <div class="alert alert-success text-center">
                        <h4><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> 评分</h4>
                        <canvas id="success-circle" width="200" height="200"></canvas>
                        <p>这个样本是良性软件，得分为 <strong><span id="score">0.5</span>%。</strong></p>
                        <p>
                            <b>请注意</b>: 评分系统仍处于研发阶段，应视为<b><i>测试</i></b>指标。
                        </p>
                    </div>
                </div>
            {% elif analysis.info.score < 2 %}
                <div class="card" >
                    <div class="alert alert-info text-center">
                        <h4><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> 评分</h4>
                        <canvas id="info-circle" width="200" height="200"></canvas>
                        <p>这个样本表现出一些潜在的恶意行为，得分为 <strong><span id="score">1.8</span>%。</strong></p>
                        <p>
                            <b>请注意</b>: 评分系统仍处于研发阶段，应视为<b><i>测试</i></b>指标。
                        </p>
                    </div>
                </div>
            {% elif analysis.info.score < 5 %}
                <div class="card" >
                    <div class="alert alert-warning text-center">
                        <h4><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> 评分</h4>
                        <canvas id="warning-circle" width="200" height="200"></canvas>
                        <p>这个样本具有大量的恶意软件行为，得分为 <strong><span id="score">4.2</span>%。</strong></p>
                        <p>
                            <b>请注意</b>: 评分系统仍处于研发阶段，应视为<b><i>测试</i></b>指标。
                        </p>
                    </div>
                </div>
            {% else %}
                <div class="card" >
                    <div class="alert alert-danger text-center">
                        <h4><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> 评分</h4>
                        <canvas id="danger-circle" width="200" height="200"></canvas>
                        <p>该样本 <b>非常危险</b>，得分为 <strong><span id="score">7.9</span>%!</strong></p>
                        <p>
                            <b>请注意</b>: 评分系统仍处于研发阶段，应视为<b><i>测试</i></b>指标。
                        </p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 样本信息 -->
    <div class="row mt-4">
        <div class="col-md-5">
            <div class="card" style="background-color: #171625">
                <div class="card-header">
                    <h4  style="color: white!important; padding-left: 10px"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> 样本信息</h4>
                </div>
                <div class="card-body">
                    <div class="file-info">
                        <ul>
                            <li ><strong>静态分析:</strong> 检测到可疑的代码段，包含潜在的加密函数调用</li>
                            <li ><strong>动态分析:</strong> 样本尝试连接到未知的远程服务器</li>
                            <li ><strong>AI 查杀结果:</strong> 检测到可能的勒索软件行为 (置信度: 85%)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 空白区域供用户添加内容 -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h4>自定义区域</h4>
                </div>
                <div class="card-body">
                    <!-- 用户可在此添加其他内容 -->
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    function drawProgress(canvasId, radius, startColor, endColor, score) {
        var canvas = document.getElementById(canvasId);
        var ctx = canvas.getContext("2d");

        var x = canvas.width / 2;
        var y = canvas.height / 2;
        var startAngle = -Math.PI / 2;
        var endAngle = Math.PI * 1.5;
        var counterClockwise = false;

        ctx.beginPath();
        ctx.arc(x, y, radius, startAngle, endAngle, counterClockwise);
        ctx.lineWidth = 10;
        ctx.strokeStyle = 'lightgrey';
        ctx.stroke();

        var normalizedScore = score / 100;
        var progressAngle = normalizedScore * Math.PI * 1.5;

        ctx.beginPath();
        ctx.arc(x, y, radius, startAngle, startAngle + progressAngle, counterClockwise);
        ctx.lineWidth = 10;
        var gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
        gradient.addColorStop(0, startColor);
        gradient.addColorStop(1, endColor);
        ctx.strokeStyle = gradient;
        ctx.stroke();

        if (score !== 0) {
            ctx.fillStyle = "black";
            ctx.font = "bold 20px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(score + "%", x, y);
        } else {
            ctx.fillStyle = "black";
            ctx.font = "bold 40px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("✓", x, y);
        }
    }

    var score = parseFloat(document.getElementById("score").innerText);

    if (score < 1) {
        drawProgress("success-circle", 80, '#dff0d8', '#3c763d', score);
    } else if (score < 2) {
        drawProgress("info-circle", 80, '#d9edf7', '#31708f', score);
    } else if (score < 5) {
        drawProgress("warning-circle", 80, '#fcf8e3', '#8a6d3b', score);
    } else {
        drawProgress("danger-circle", 80, '#f2dede', '#a94442', score);
    }

    function downloadReport() {
        window.alert('报告下载功能即将上线');
    }
</script>
{% endblock %}
{% endblock %}